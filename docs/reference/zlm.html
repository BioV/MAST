<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Zero-inflated regression for SingleCellAssay — zlm • MAST</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">MAST</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/RGLab/MAST/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Zero-inflated regression for SingleCellAssay</h1>
    </div>

    
    <p>For each gene in sca, fits the hurdle model in <code>formula</code> (linear for et&gt;0), logistic for et==0 vs et&gt;0.
Return an object of class <code>ZlmFit</code> containing slots giving the coefficients, variance-covariance matrices, etc.
After each gene, optionally run the function on the fit named by &#39;hook&#39;</p>
    

    <pre><span class='fu'>zlm</span>(<span class='no'>formula</span>, <span class='no'>sca</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"bayesglm"</span>, <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>ebayes</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>ebayesControl</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>force</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>hook</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='no'>LMlike</span>, <span class='kw'>onlyCoef</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>formula</dt>
      <dd>a formula with the measurement variable on the LHS and predictors present in colData on the RHS</dd>
      <dt>sca</dt>
      <dd>SingleCellAssay object</dd>
      <dt>method</dt>
      <dd>character vector, either &#39;glm&#39;, &#39;glmer&#39; or &#39;bayesglm&#39;</dd>
      <dt>silent</dt>
      <dd>Silence common problems with fitting some genes</dd>
      <dt>ebayes</dt>
      <dd>if TRUE, regularize variance using empirical bayes method</dd>
      <dt>ebayesControl</dt>
      <dd>list with parameters for empirical bayes procedure.  See <a href='ebayes.html'>ebayes</a>.</dd>
      <dt>force</dt>
      <dd>Should we continue testing genes even after many errors have occurred?</dd>
      <dt>hook</dt>
      <dd>a function called on the <code>fit</code> after each gene.</dd>
      <dt>parallel</dt>
      <dd>If TRUE and <code>option(mc.cores)&gt;1</code> then multiple cores will be used in fitting.</dd>
      <dt>LMlike</dt>
      <dd>if provided, then the model defined in this object will be used, rather than following the formulas.  This is intended for internal use.</dd>
      <dt>onlyCoef</dt>
      <dd>If TRUE then only an array of model coefficients will be returned (probably only useful for bootstrapping).</dd>
      <dt>...</dt>
      <dd>arguments passed to the S4 model object upon construction.  For example, <code>fitArgsC</code> and <code>fitArgsD</code>, or <code>coefPrior</code>.</dd>
    </dl>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a object of class <code>ZlmFit</code> with methods to extract coefficients, etc. 
OR, if data is a <code>data.frame</code> just a list of the discrete and continuous fits.</p>
    
    <h2 class="hasAnchor" id="empirical-bayes-variance-regularization"><a class="anchor" href="#empirical-bayes-variance-regularization"></a>Empirical Bayes variance regularization</h2>

    <p></p>
    <p>The empirical bayes regularization of the gene variance assumes that the precision (1/variance) is drawn from a
gamma distribution with unknown parameters.
These parameters are estimated by considering the distribution of sample variances over all genes.
The procedure used for this is determined from
<code>ebayesControl</code>, a named list with components &#39;method&#39; (one of &#39;MOM&#39; or &#39;MLE&#39;) and &#39;model&#39; (one of &#39;H0&#39; or &#39;H1&#39;)
method MOM uses a method-of-moments estimator, while MLE using the marginal likelihood.
H0 model estimates the precisions using the intercept alone in each gene, while H1 fits the full model specified by <code>formula</code></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>ZlmFit-class, ebayes, GLMlike-class, BayesGLMlike-class</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='no'>vbetaFA</span>)
<span class='no'>zlmVbeta</span> <span class='kw'>&lt;-</span> <span class='fu'>zlm</span>(~ <span class='no'>Stim.Condition</span>, <span class='fu'>subset</span>(<span class='no'>vbetaFA</span>, <span class='no'>ncells</span><span class='kw'>==</span><span class='fl'>1</span>)[<span class='fl'>1</span>:<span class='fl'>10</span>,])</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>slotNames</span>(<span class='no'>zlmVbeta</span>)</div><div class='output co'>#&gt;  [1] &quot;coefC&quot;              &quot;coefD&quot;              &quot;vcovC&quot;             
#&gt;  [4] &quot;vcovD&quot;              &quot;LMlike&quot;             &quot;sca&quot;               
#&gt;  [7] &quot;deviance&quot;           &quot;loglik&quot;             &quot;df.null&quot;           
#&gt; [10] &quot;df.resid&quot;           &quot;dispersion&quot;         &quot;dispersionNoshrink&quot;
#&gt; [13] &quot;priorDOF&quot;           &quot;priorVar&quot;           &quot;converged&quot;         
#&gt; [16] &quot;hookOut&quot;           </div><div class='input'><span class='co'>#A matrix of coefficients</span>
<span class='fu'>coef</span>(<span class='no'>zlmVbeta</span>, <span class='st'>'D'</span>)[<span class='st'>'CCL2'</span>,]</div><div class='output co'>#&gt;          (Intercept) Stim.ConditionUnstim 
#&gt;           -3.8329217           -0.5108005 </div><div class='input'><span class='co'>#An array of covariance matrices</span>
<span class='fu'>vcov</span>(<span class='no'>zlmVbeta</span>, <span class='st'>'D'</span>)[,,<span class='st'>'CCL2'</span>]</div><div class='output co'>#&gt;                      (Intercept) Stim.ConditionUnstim
#&gt; (Intercept)            0.1439196           -0.1254838
#&gt; Stim.ConditionUnstim  -0.1254838            0.9182853</div><div class='input'><span class='fu'><a href='waldTest.html'>waldTest</a></span>(<span class='no'>zlmVbeta</span>, <span class='fu'><a href='Hypothesis.html'>CoefficientHypothesis</a></span>(<span class='st'>'Stim.ConditionUnstim'</span>))</div><div class='output co'>#&gt; , , metric = lambda
#&gt; 
#&gt;         test.type
#&gt; primerid         cont        disc    hurdle
#&gt;   B3GAT1 0.9617702324 0.038250068  1.000020
#&gt;   BAX    7.2211565188 3.645901878 10.867058
#&gt;   BCL2   0.3766814067 2.202291748  2.578973
#&gt;   CCL2   0.8414775522 0.284135226  1.125613
#&gt;   CCL3             NA 3.548463195        NA
#&gt;   CCL4             NA 2.012308210        NA
#&gt;   CCL5   0.1746468538 0.862093478  1.036740
#&gt;   CCR2   5.3383734489 2.308408187  7.646782
#&gt;   CCR4   2.0437612666 0.003737042  2.047498
#&gt;   CCR5   0.0005534473 2.811952306  2.812506
#&gt; 
#&gt; , , metric = df
#&gt; 
#&gt;         test.type
#&gt; primerid cont disc hurdle
#&gt;   B3GAT1    1    1      2
#&gt;   BAX       1    1      2
#&gt;   BCL2      1    1      2
#&gt;   CCL2      1    1      2
#&gt;   CCL3      1    1      2
#&gt;   CCL4      1    1      2
#&gt;   CCL5      1    1      2
#&gt;   CCR2      1    1      2
#&gt;   CCR4      1    1      2
#&gt;   CCR5      1    1      2
#&gt; 
#&gt; , , metric = Pr(&gt;Chisq)
#&gt; 
#&gt;         test.type
#&gt; primerid        cont       disc      hurdle
#&gt;   B3GAT1 0.326741272 0.84494185 0.606524503
#&gt;   BAX    0.007204927 0.05620735 0.004367654
#&gt;   BCL2   0.539384664 0.13780573 0.275412150
#&gt;   CCL2   0.358974532 0.59400356 0.569608276
#&gt;   CCL3            NA 0.05960063          NA
#&gt;   CCL4            NA 0.15602777          NA
#&gt;   CCL5   0.676014596 0.35315351 0.595490308
#&gt;   CCR2   0.020860929 0.12867576 0.021853574
#&gt;   CCR4   0.152831343 0.95125460 0.359245545
#&gt;   CCR5   0.981231129 0.09356445 0.245059834
#&gt; </div><div class='input'>
<span class='co'>## Can also provide just a \code{data.frame} instead</span>
<span class='no'>data</span><span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>x</span><span class='kw'>=</span><span class='fu'>rnorm</span>(<span class='fl'>500</span>), <span class='kw'>z</span><span class='kw'>=</span><span class='fu'>rbinom</span>(<span class='fl'>500</span>, <span class='fl'>1</span>, <span class='fl'>.3</span>))
<span class='no'>logit.y</span> <span class='kw'>&lt;-</span> <span class='fu'>with</span>(<span class='no'>data</span>, <span class='no'>x</span>*<span class='fl'>2</span> + <span class='no'>z</span>*<span class='fl'>2</span>); <span class='no'>mu.y</span> <span class='kw'>&lt;-</span> <span class='fu'>with</span>(<span class='no'>data</span>, <span class='fl'>10</span>+<span class='fl'>10</span>*<span class='no'>x</span>+<span class='fl'>10</span>*<span class='no'>z</span> + <span class='fu'>rnorm</span>(<span class='fl'>500</span>))
<span class='no'>y</span> <span class='kw'>&lt;-</span> (<span class='fu'>runif</span>(<span class='fl'>500</span>)<span class='kw'>&lt;</span><span class='fu'>exp</span>(<span class='no'>logit.y</span>)/(<span class='fl'>1</span>+<span class='fu'>exp</span>(<span class='no'>logit.y</span>)))*<span class='fl'>1</span>
<span class='no'>y</span>[<span class='no'>y</span><span class='kw'>&gt;</span><span class='fl'>0</span>] <span class='kw'>&lt;-</span> <span class='no'>mu.y</span>[<span class='no'>y</span><span class='kw'>&gt;</span><span class='fl'>0</span>]
<span class='no'>data</span>$<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>y</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>zlm</span>(<span class='no'>y</span> ~ <span class='no'>x</span>+<span class='no'>z</span>, <span class='no'>data</span>)
<span class='fu'>summary.glm</span>(<span class='no'>fit</span>$<span class='no'>disc</span>)</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; NULL
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -61.894   -1.166    1.026    1.222   13.041  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept) -0.07795    0.14163   -0.55    0.582    
#&gt; x            2.29625    0.21140   10.86  &lt; 2e-16 ***
#&gt; z            2.17599    0.31444    6.92 4.51e-12 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 673.81  on 499  degrees of freedom
#&gt; Residual deviance: 392.34  on 198  degrees of freedom
#&gt; AIC: 398.34
#&gt; 
#&gt; Number of Fisher Scoring iterations: 6
#&gt; </div><div class='input'><span class='fu'>summary.glm</span>(<span class='no'>fit</span>$<span class='no'>cont</span>)</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; NULL
#&gt; 
#&gt; Deviance Residuals: 
#&gt;      Min        1Q    Median        3Q       Max  
#&gt; -2.59967  -0.65259  -0.01839   0.69351   3.02403  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept) 10.10482    0.09557  105.73   &lt;2e-16 ***
#&gt; x            9.92099    0.08191  121.12   &lt;2e-16 ***
#&gt; z            9.86772    0.12569   78.51   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; 
#&gt; (Dispersion parameter for gaussian family taken to be 1.095119)
#&gt; 
#&gt;     Null deviance: 19666.38  on 298  degrees of freedom
#&gt; Residual deviance:   324.16  on 296  degrees of freedom
#&gt; AIC: 880.68
#&gt; 
#&gt; Number of Fisher Scoring iterations: 2
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#empirical-bayes-variance-regularization">Empirical Bayes variance regularization</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Andrew McDavid, Greg Finak, Masanao Yajima.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
